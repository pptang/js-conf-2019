import {Cite} from 'spectacle';
import { CodeSlide, LightSlide} from './slides';
import RegularComponent from './regular-component';
import avatar from '../assets/avatar.jpg';
import mercari from '../assets/mercari-logo.png';
import marketplace from '../assets/marketplace.png';
import Avatar from '../src/components/Avatar';

import AnimationSlide from '../src/components/AnimationSlide';

# JSConf 2019

---
<div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', color: 'white'}}>
  <p style={{marginRight: '20px'}}>Hello, I'm Paipo ðŸ™Œ </p>
  <Avatar name="Paipo" src={avatar} />
</div>

---

export default LightSlide

<div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center'}}>
  I work at <img src={mercari} style={{ width: '200px', objectFit: 'cover' }} />
</div>

---

export default LightSlide

<div style={{ fontSize: '1.6rem'}}>Mercari is a C2C marketplace app, </div>
<div style={{ fontSize: '1.6rem'}}>that allows users to enjoy buying and selling.</div>

<img src={marketplace} style={{ width: '600px' }} />

---

Every marketplace app has a common problem...

---

## Why this page is so critical?

- Essence of a marketplace App (Buy & Sell)
- Directly affect the convertion to GMV $$$
- A lot of business logic involved

---

## What makes heavy business logic?

- Buyer & Seller
- Different types of transaction (clothes, smartphone, furniture, car)
- Different Delivery Methods
- Transaction Progress (Payment -> Delivery -> ? -> Review -> Finish)

---

<AnimationSlide title="Let's do Re-Architecture"/>

---

## Mercari Webview Architecture

---

## Re-Architecture - Target

- Turn spaghetti code into more maintainable, readable, and less WTF code.
  (Use emoji or GIF or whatever)
- Good Test coverage.
- Better UI/UX with design system in mind.

---

## Start from Scratch or Migrate Page by Page

---

Considering it's Transaction Page...

# We go for Migrate Page by Page!

---

## Problems for current codebase

- Background
  - Knockpout.js + jQuery + HTML/CSS
- A huge file with all business logic
  - (img: Show lines of code screen shot)
- Mix business logic and display logic in an imperative way
  - (img: show sample ko if: html code)
- Hard to maintain (trace) the code
  - Bad encapsulation (show many Hows in the code instead what or why)
  - Magic numbers, literal strings are scattered everywhere

---

# Find the divisible unit

---

## Target
  - Can be released as independent business case
  - Easy to co-work as team
  - Easy to add/remove

---

# "How to handle those logicðŸ¤”?"

---

# Display Logic v.s Buiness Logic

---

...

---

## Testing Strategies

- Unit Test -> Storyshot, enzyme to test display logic
- Sagas Test -> to test business logic
- Cypress Test -> to test whole user flow (whole story) -> story as a cypress spec

---

## Challenges

- Adding new features and Doing Re-Architecture at the same time
- Supported Platforms, Accessibilities
  (As a leading second-handed marketplace app, we have to support wide range of platforms) -> we don't want to lose any market shares
- Performance Issues -> Especially transaction page -> better code splitting and setting performance budget

---

## Current Result

- 60% of item transaction page is migrated to new codebase.

---

## Roadmap
- Move to Web
  - How putting business logic in sagas can help, how different layers of logic can help.
- Apply Design System
  - How Different unit of view component can help

---

## Conclusions
- Architecture is about different layers, make reasonable decisions to separate layers can make your codebase easier to maintain and test.
- It's quite challenging to add new feature and do re-architecture at the same time, so better do one thing at a time.

---

# Don't make your spaghetti code another spaghetti with newly-added flavors.

---

# Thank you!